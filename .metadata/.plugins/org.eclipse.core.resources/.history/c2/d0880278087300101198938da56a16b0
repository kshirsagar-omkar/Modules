<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Razorpay Integration (Callback URL)</title>
</head>
<body>

<form id="paymentForm">
    <label for="amount">Amount:</label>
    <input type="text" id="amount" name="amount" required><br><br>
    <button type="button" onclick="makePayment()">Pay Now</button>
</form>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
function makePayment() {
    const amount = document.getElementById("amount").value;
    // ✅ Get context path dynamically
    const contextPath = '<%= request.getContextPath() %>';

    fetch(contextPath + '/create-order', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'amount=' + encodeURIComponent(amount)
    })
    .then(response => response.json())
    .then(order => {
        const options = {
            "key": "<%= RezorpayUtil.getRazorpayKeyId() %>",
            "amount": order.amount,
            "currency": order.currency,
            "name": "Your Company Name",
            "description": "Test Transaction",
            "order_id": order.id,
            // ✅ Dynamic callback URL with context path
            "callback_url": contextPath + "/payment-callback",
            "prefill": {
                "name": "User Name",
                "email": "user@example.com"
            }
        };
        const rzp1 = new Razorpay(options);
        rzp1.open();
    })
    .catch(error => {
        console.error("Error creating order:", error);
    });
}
</script>

</body>
</html>
